<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - NextGen InnoHub</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f5f7fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.8em; }
        .header div { display: flex; gap: 10px; }
        .logout-btn { background: rgba(255,255,255,0.2); color: white; padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .welcome { background: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .card h3 { color: #667eea; margin-bottom: 15px; font-size: 1.3em; }
        .btn { display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 25px; border: none; border-radius: 8px; margin: 5px; font-weight: 600; cursor: pointer; }
        .btn:hover { transform: translateY(-2px); }
        .btn-secondary { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 2px solid #e0e0e0; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background: #f0f9ff; color: #667eea; font-weight: 600; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; margin: 50px auto; padding: 30px; border-radius: 15px; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß Admin Dashboard</h1>
        <div>
            <button class="logout-btn" onclick="window.location.href='change-password.html'" style="margin-right: 10px;">üîê Change Password</button>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="container">
        <div class="welcome">
            <h2>Welcome, <span id="adminName">Admin</span>! üëã</h2>
            <p style="color: #64748b; margin-top: 10px;">All data is stored locally in your browser. Export regularly!</p>
        </div>

        <div class="grid">
            <div class="card">
                <h3>üë• User Management</h3>
                <button class="btn" onclick="openModal('addUser')">‚ûï Add New User</button>
                <button class="btn btn-secondary" onclick="viewData('users')">üìä View All Users</button>
            </div>

            <div class="card">
                <h3>üë®‚Äçüíº Lead Intern Management</h3>
                <button class="btn" onclick="openModal('addLeadIntern')">‚ûï Add Lead Intern</button>
                <button class="btn btn-secondary" onclick="openModal('promoteIntern')">‚¨ÜÔ∏è Promote to Lead</button>
                <button class="btn btn-secondary" onclick="viewLeadInterns()">üìä View Lead Interns</button>
            </div>

            <div class="card">
                <h3>üéì Intern Management</h3>
                <button class="btn" onclick="openModal('addIntern')">‚ûï Add Intern</button>
                <button class="btn btn-secondary" onclick="viewData('interns')">üìä View All Interns</button>
            </div>

            <div class="card">
                <h3>üìã Task Management</h3>
                <button class="btn" onclick="openModal('addTask')">‚ûï Create Task Template</button>
                <button class="btn btn-secondary" onclick="viewData('tasks')">üìä View All Tasks</button>
            </div>

            <div class="card">
                <h3>üìú Certificates</h3>
                <button class="btn" onclick="window.location.href='generate-certificate.html'">üéñÔ∏è Generate Certificate</button>
                <button class="btn btn-secondary" onclick="viewData('certificates')">üìä View Certificates</button>
            </div>

            <div class="card">
                <h3>üíæ Data Management</h3>
                <button class="btn" onclick="exportData()">üì• Export All Data</button>
                <button class="btn btn-secondary" onclick="importData()">üì§ Import Data</button>
            </div>
        </div>

        <div id="dataView" class="card" style="margin-top: 30px; display: none;">
            <h3 id="dataTitle">Data View</h3>
            <div id="dataContent"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addUser')">&times;</span>
            <h3>Add New User</h3>
            <form onsubmit="addUser(event)">
                <input type="text" placeholder="Username" required name="username">
                <input type="password" placeholder="Password" required name="password">
                <select name="role" required>
                    <option value="">Select Role</option>
                    <option value="admin">Admin</option>
                    <option value="employee">Employee</option>
                    <option value="intern">Intern</option>
                </select>
                <input type="text" placeholder="Full Name" required name="name">
                <input type="email" placeholder="Email" required name="email">
                <select name="domain">
                    <option value="">Select Domain</option>
                    <option value="HR">HR</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Testing">Testing</option>
                    <option value="Python">Python</option>
                    <option value="React">React</option>
                </select>
                <button type="submit" class="btn">Add User</button>
            </form>
        </div>
    </div>

    <div id="addInternModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addIntern')">&times;</span>
            <h3>Add Intern</h3>
            <form onsubmit="addIntern(event)">
                <input type="text" placeholder="Intern Name" required name="name">
                <input type="email" placeholder="Email" required name="email">
                <input type="tel" placeholder="Phone" required name="phone">
                <select name="domain" required>
                    <option value="">Select Domain</option>
                    <option value="HR">HR</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Testing">Testing</option>
                    <option value="Python">Python</option>
                    <option value="React">React</option>
                </select>
                <select name="assignedTo" id="leadInternSelect" required>
                    <option value="">Select Lead Intern</option>
                </select>
                <button type="submit" class="btn">Add Intern</button>
            </form>
        </div>
    </div>

    <div id="addLeadInternModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addLeadIntern')">&times;</span>
            <h3>Add Lead Intern</h3>
            <form onsubmit="addLeadIntern(event)">
                <input type="text" placeholder="Username" required name="username">
                <input type="password" placeholder="Password" required name="password" minlength="6">
                <input type="text" placeholder="Full Name" required name="name">
                <input type="email" placeholder="Email" required name="email">
                <select name="domain" required>
                    <option value="">Select Domain</option>
                    <option value="HR">HR</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Testing">Testing</option>
                    <option value="Python">Python</option>
                    <option value="React">React</option>
                </select>
                <button type="submit" class="btn">Add Lead Intern</button>
            </form>
        </div>
    </div>

    <div id="promoteInternModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('promoteIntern')">&times;</span>
            <h3>Promote Intern to Lead</h3>
            <form onsubmit="promoteIntern(event)">
                <select name="internId" id="internPromoteSelect" required>
                    <option value="">Select Intern to Promote</option>
                </select>
                <input type="text" placeholder="Username for Login" required name="username">
                <input type="password" placeholder="Password" required name="password" minlength="6">
                <button type="submit" class="btn">Promote to Lead Intern</button>
            </form>
        </div>
    </div>

    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addTask')">&times;</span>
            <h3>Create Task Template</h3>
            <form onsubmit="addTask(event)">
                <input type="text" placeholder="Task Title" required name="title">
                <textarea placeholder="Task Description" required name="description" rows="3"></textarea>
                <select name="domain" required>
                    <option value="">Select Domain</option>
                    <option value="HR">HR</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Testing">Testing</option>
                    <option value="Python">Python</option>
                    <option value="React">React</option>
                </select>
                <input type="text" placeholder="Estimated Duration (e.g., 2 days)" name="duration">
                <button type="submit" class="btn">Create Task Template</button>
            </form>
        </div>
    </div>

    <div id="addCertModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addCert')">&times;</span>
            <h3>Generate Certificate</h3>
            <form onsubmit="addCertificate(event)">
                <input type="text" placeholder="Intern Name" required name="name">
                <input type="date" placeholder="Date of Birth" name="dob">
                <input type="text" placeholder="Place" name="place">
                <select name="domain" required>
                    <option value="">Select Domain</option>
                    <option value="HR">HR</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Testing">Testing</option>
                    <option value="Python">Python</option>
                    <option value="React">React</option>
                </select>
                <select name="months" required>
                    <option value="">Duration</option>
                    <option value="1">1 Month</option>
                    <option value="2">2 Months</option>
                    <option value="3">3 Months</option>
                    <option value="6">6 Months</option>
                </select>
                <select name="performance" required>
                    <option value="">Performance</option>
                    <option value="Excellent">Excellent</option>
                    <option value="Very Good">Very Good</option>
                    <option value="Good">Good</option>
                </select>
                <button type="submit" class="btn">Generate</button>
            </form>
        </div>
    </div>

    <script src="db.js"></script>
    <script>
        const user = JSON.parse(localStorage.getItem('currentUser'));
        if (!user || user.role !== 'admin') window.location.href = 'portal-login.html';
        document.getElementById('adminName').textContent = user.name;

        function openModal(type) { 
            document.getElementById(type + 'Modal').style.display = 'block';
            if (type === 'addIntern') loadLeadInterns();
            if (type === 'promoteIntern') loadInternsForPromotion();
        }
        function closeModal(type) { document.getElementById(type + 'Modal').style.display = 'none'; }

        function loadLeadInterns() {
            const users = DB.getAll('users');
            const leadInterns = users.filter(u => u.role === 'employee');
            const select = document.getElementById('leadInternSelect');
            select.innerHTML = '<option value="">Select Lead Intern</option>';
            leadInterns.forEach(lead => {
                select.innerHTML += `<option value="${lead.name}">${lead.name} (${lead.domain || 'All'})</option>`;
            });
        }

        function loadInternsForPromotion() {
            const interns = DB.getAll('interns');
            const select = document.getElementById('internPromoteSelect');
            select.innerHTML = '<option value="">Select Intern to Promote</option>';
            interns.forEach(intern => {
                select.innerHTML += `<option value="${intern.id}">${intern.name} - ${intern.domain}</option>`;
            });
        }

        function addLeadIntern(e) {
            e.preventDefault();
            const data = new FormData(e.target);
            const leadData = Object.fromEntries(data);
            leadData.role = 'employee';
            
            const users = DB.getAll('users');
            const exists = users.find(u => u.username === leadData.username);
            if (exists) {
                alert('‚ùå Username already exists!');
                return;
            }
            
            DB.addUser(leadData);
            alert('‚úÖ Lead Intern added successfully!');
            e.target.reset();
            closeModal('addLeadIntern');
        }

        function promoteIntern(e) {
            e.preventDefault();
            const data = new FormData(e.target);
            const internId = data.get('internId');
            const username = data.get('username');
            const password = data.get('password');
            
            const interns = DB.getAll('interns');
            const intern = interns.find(i => i.id == internId);
            
            if (!intern) {
                alert('‚ùå Intern not found!');
                return;
            }
            
            const users = DB.getAll('users');
            const exists = users.find(u => u.username === username);
            if (exists) {
                alert('‚ùå Username already exists!');
                return;
            }
            
            const leadData = {
                username: username,
                password: password,
                role: 'employee',
                name: intern.name,
                email: intern.email,
                domain: intern.domain
            };
            
            DB.addUser(leadData);
            alert(`‚úÖ ${intern.name} promoted to Lead Intern successfully!`);
            e.target.reset();
            closeModal('promoteIntern');
        }

        function addIntern(e) {
            e.preventDefault();
            const data = new FormData(e.target);
            const internData = Object.fromEntries(data);
            
            if (!internData.assignedTo) {
                alert('‚ùå Please select a Lead Intern!');
                return;
            }
            
            const users = DB.getAll('users');
            const leadExists = users.find(u => u.role === 'employee' && u.name === internData.assignedTo);
            
            if (!leadExists) {
                alert(`‚ùå Lead Intern "${internData.assignedTo}" does not exist! Please add them first.`);
                return;
            }
            
            DB.addIntern(internData);
            alert('‚úÖ Intern added successfully!');
            e.target.reset();
            closeModal('addIntern');
        }

        function viewLeadInterns() {
            const users = DB.getAll('users');
            const leadInterns = users.filter(u => u.role === 'employee');
            const view = document.getElementById('dataView');
            const content = document.getElementById('dataContent');
            document.getElementById('dataTitle').textContent = 'LEAD INTERNS';
            
            if (leadInterns.length === 0) {
                content.innerHTML = '<p>No lead interns found</p>';
            } else {
                let html = '<table><tr><th>Name</th><th>Username</th><th>Email</th><th>Domain</th><th>Actions</th></tr>';
                leadInterns.forEach(lead => {
                    html += `<tr><td>${lead.name}</td><td>${lead.username}</td><td>${lead.email || '-'}</td><td>${lead.domain || 'All'}</td>`;
                    html += `<td><button class="btn" style="background: #ef4444; padding: 8px 16px;" onclick="deleteLeadIntern('${lead.username}')">Delete</button></td></tr>`;
                });
                html += '</table>';
                content.innerHTML = html;
            }
            view.style.display = 'block';
        }

        function deleteLeadIntern(username) {
            if (!confirm('Are you sure you want to delete this Lead Intern? This will also unassign all their interns.')) return;
            
            const users = DB.getAll('users');
            const filtered = users.filter(u => u.username !== username);
            localStorage.setItem('users', JSON.stringify(filtered));
            
            const interns = DB.getAll('interns');
            interns.forEach(intern => {
                if (intern.assignedTo === username) {
                    intern.assignedTo = '';
                }
            });
            localStorage.setItem('interns', JSON.stringify(interns));
            
            alert('‚úÖ Lead Intern deleted successfully!');
            viewLeadInterns();
        }

        function addUser(e) {
            e.preventDefault();
            const data = new FormData(e.target);
            DB.addUser(Object.fromEntries(data));
            alert('‚úÖ User added successfully!');
            e.target.reset();
            closeModal('addUser');
        }

        function addTask(e) {
            e.preventDefault();
            const data = new FormData(e.target);
            const task = Object.fromEntries(data);
            task.id = 'TASK' + Date.now();
            task.status = 'Template';
            task.createdBy = 'Admin';
            task.createdAt = new Date().toISOString();
            DB.addTask(task);
            alert('‚úÖ Task template created successfully! Lead Interns can now assign this to their team.');
            e.target.reset();
            closeModal('addTask');
        }

        function addCertificate(e) {
            e.preventDefault();
            const data = new FormData(e.target);
            const cert = Object.fromEntries(data);
            cert.dateIssued = new Date().toLocaleDateString();
            DB.addCertificate(cert);
            alert('‚úÖ Certificate generated!');
            e.target.reset();
            closeModal('addCert');
        }

        function viewData(type) {
            const data = DB.getAll(type);
            const view = document.getElementById('dataView');
            const content = document.getElementById('dataContent');
            document.getElementById('dataTitle').textContent = type.toUpperCase();
            
            if (data.length === 0) {
                content.innerHTML = '<p>No data found</p>';
            } else {
                const keys = Object.keys(data[0]);
                let html = '<table><tr>';
                keys.forEach(k => html += `<th>${k}</th>`);
                html += '<th>Actions</th></tr>';
                data.forEach(row => {
                    html += '<tr>';
                    keys.forEach(k => html += `<td>${row[k] || '-'}</td>`);
                    html += `<td><button class="btn" style="background: #ef4444; padding: 8px 16px;" onclick="deleteItem('${type}', '${row.id}')">Delete</button></td>`;
                    html += '</tr>';
                });
                html += '</table>';
                content.innerHTML = html;
            }
            view.style.display = 'block';
        }

        function deleteItem(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            DB.delete(type, id);
            alert('‚úÖ Item deleted successfully!');
            viewData(type);
        }

        function exportData() {
            const data = {
                users: DB.getAll('users'),
                interns: DB.getAll('interns'),
                tasks: DB.getAll('tasks'),
                certificates: DB.getAll('certificates')
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'nextgen-innohub-data-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            alert('‚úÖ Data exported successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    const data = JSON.parse(event.target.result);
                    localStorage.setItem('users', JSON.stringify(data.users || []));
                    localStorage.setItem('interns', JSON.stringify(data.interns || []));
                    localStorage.setItem('tasks', JSON.stringify(data.tasks || []));
                    localStorage.setItem('certificates', JSON.stringify(data.certificates || []));
                    alert('‚úÖ Data imported successfully!');
                    location.reload();
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'portal-login.html';
        }
    </script>
</body>
</html>
